var O=Object.defineProperty;var P=(e,t,n)=>t in e?O(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var g=(e,t,n)=>P(e,typeof t!="symbol"?t+"":t,n);const w=e=>(e=e.filter(Boolean),e.length<2?e[0]||"":j(e)==1?"["+e.join("")+"]":"(?:"+e.join("|")+")"),z=e=>{if(!M(e))return e.join("");let t="",n=0;const r=()=>{n>1&&(t+="{"+n+"}")};return e.forEach((i,s)=>{if(i===e[s-1]){n++;return}r(),t+=i,n=1}),r(),t},$=e=>{let t=Array.from(e);return w(t)},M=e=>new Set(e).size!==e.length,m=e=>(e+"").replace(/([\$\(\)\*\+\.\?\[\]\^\{\|\}\\])/gu,"\\$1"),j=e=>e.reduce((t,n)=>Math.max(t,q(n)),0),q=e=>Array.from(e).length,C=e=>{if(e.length===1)return[[e]];let t=[];const n=e.substring(1);return C(n).forEach(function(i){let s=i.slice(0);s[0]=e.charAt(0)+s[0],t.push(s),s=i.slice(0),s.unshift(e.charAt(0)),t.push(s)}),t},N=[[0,65535]],R="[̀-ͯ·ʾʼ]";let _,L;const T=3,x={},A={"/":"⁄∕",0:"߀",a:"ⱥɐɑ",aa:"ꜳ",ae:"æǽǣ",ao:"ꜵ",au:"ꜷ",av:"ꜹꜻ",ay:"ꜽ",b:"ƀɓƃ",c:"ꜿƈȼↄ",d:"đɗɖᴅƌꮷԁɦ",e:"ɛǝᴇɇ",f:"ꝼƒ",g:"ǥɠꞡᵹꝿɢ",h:"ħⱨⱶɥ",i:"ɨı",j:"ɉȷ",k:"ƙⱪꝁꝃꝅꞣ",l:"łƚɫⱡꝉꝇꞁɭ",m:"ɱɯϻ",n:"ꞥƞɲꞑᴎлԉ",o:"øǿɔɵꝋꝍᴑ",oe:"œ",oi:"ƣ",oo:"ꝏ",ou:"ȣ",p:"ƥᵽꝑꝓꝕρ",q:"ꝗꝙɋ",r:"ɍɽꝛꞧꞃ",s:"ßȿꞩꞅʂ",t:"ŧƭʈⱦꞇ",th:"þ",tz:"ꜩ",u:"ʉ",v:"ʋꝟʌ",vy:"ꝡ",w:"ⱳ",y:"ƴɏỿ",z:"ƶȥɀⱬꝣ",hv:"ƕ"};for(let e in A){let t=A[e]||"";for(let n=0;n<t.length;n++){let r=t.substring(n,n+1);x[r]=e}}const k=new RegExp(Object.keys(x).join("|")+"|"+R,"gu"),D=e=>{_===void 0&&(_=K(N))},F=(e,t="NFKD")=>e.normalize(t),b=e=>Array.from(e).reduce((t,n)=>t+J(n),""),J=e=>(e=F(e).toLowerCase().replace(k,t=>x[t]||""),F(e,"NFC"));function*V(e){for(const[t,n]of e)for(let r=t;r<=n;r++){let i=String.fromCharCode(r),s=b(i);s!=i.toLowerCase()&&(s.length>T||s.length!=0&&(yield{folded:s,composed:i,code_point:r}))}}const B=e=>{const t={},n=(r,i)=>{const s=t[r]||new Set,o=new RegExp("^"+$(s)+"$","iu");i.match(o)||(s.add(m(i)),t[r]=s)};for(let r of V(e))n(r.folded,r.folded),n(r.folded,r.composed);return t},K=e=>{const t=B(e),n={};let r=[];for(let s in t){let o=t[s];o&&(n[s]=$(o)),s.length>1&&r.push(m(s))}r.sort((s,o)=>o.length-s.length);const i=w(r);return L=new RegExp("^"+i,"u"),n},G=(e,t=1)=>{let n=0;return e=e.map(r=>(_[r]&&(n+=r.length),_[r]||r)),n>=t?z(e):""},H=(e,t=1)=>(t=Math.max(t,e.length-1),w(C(e).map(n=>G(n,t)))),E=(e,t=!0)=>{let n=e.length>1?1:0;return w(e.map(r=>{let i=[];const s=t?r.length():r.length()-1;for(let o=0;o<s;o++)i.push(H(r.substrs[o]||"",n));return z(i)}))},I=(e,t)=>{for(const n of t){if(n.start!=e.start||n.end!=e.end||n.substrs.join("")!==e.substrs.join(""))continue;let r=e.parts;const i=o=>{for(const c of r){if(c.start===o.start&&c.substr===o.substr)return!1;if(!(o.length==1||c.length==1)&&(o.start<c.start&&o.end>c.start||c.start<o.start&&c.end>o.start))return!0}return!1};if(!(n.parts.filter(i).length>0))return!0}return!1};class S{constructor(){g(this,"parts");g(this,"substrs");g(this,"start");g(this,"end");this.parts=[],this.substrs=[],this.start=0,this.end=0}add(t){t&&(this.parts.push(t),this.substrs.push(t.substr),this.start=Math.min(t.start,this.start),this.end=Math.max(t.end,this.end))}last(){return this.parts[this.parts.length-1]}length(){return this.parts.length}clone(t,n){let r=new S,i=JSON.parse(JSON.stringify(this.parts)),s=i.pop();for(const a of i)r.add(a);let o=n.substr.substring(0,t-s.start),c=o.length;return r.add({start:s.start,end:s.start+c,length:c,substr:o}),r}}const Q=e=>{D(),e=b(e);let t="",n=[new S];for(let r=0;r<e.length;r++){let s=e.substring(r).match(L);const o=e.substring(r,r+1),c=s?s[0]:null;let a=[],l=new Set;for(const u of n){const f=u.last();if(!f||f.length==1||f.end<=r)if(c){const h=c.length;u.add({start:r,end:r+h,length:h,substr:c}),l.add("1")}else u.add({start:r,end:r+1,length:1,substr:o}),l.add("2");else if(c){let h=u.clone(r,f);const d=c.length;h.add({start:r,end:r+d,length:d,substr:c}),a.push(h)}else l.add("3")}if(a.length>0){a=a.sort((u,f)=>u.length()-f.length());for(let u of a)I(u,n)||n.push(u);continue}if(r>0&&l.size==1&&!l.has("3")){t+=E(n,!1);let u=new S;const f=n[0];f&&u.add(f.last()),n=[u]}}return t+=E(n,!0),t},U=(e,t)=>{if(e)return e[t]},W=(e,t)=>{if(e){for(var n,r=t.split(".");(n=r.shift())&&(e=e[n]););return e}},v=(e,t,n)=>{var r,i;return!e||(e=e+"",t.regex==null)||(i=e.search(t.regex),i===-1)?0:(r=t.string.length/e.length,i===0&&(r+=.5),r*n)},y=(e,t)=>{var n=e[t];if(typeof n=="function")return n;n&&!Array.isArray(n)&&(e[t]=[n])},p=(e,t)=>{if(Array.isArray(e))e.forEach(t);else for(var n in e)e.hasOwnProperty(n)&&t(e[n],n)},X=(e,t)=>typeof e=="number"&&typeof t=="number"?e>t?1:e<t?-1:0:(e=b(e+"").toLowerCase(),t=b(t+"").toLowerCase(),e>t?1:t>e?-1:0);class tt{constructor(t,n){g(this,"items");g(this,"settings");this.items=t,this.settings=n||{diacritics:!0}}tokenize(t,n,r){if(!t||!t.length)return[];const i=[],s=t.split(/\s+/);var o;return r&&(o=new RegExp("^("+Object.keys(r).map(m).join("|")+"):(.*)$")),s.forEach(c=>{let a,l=null,u=null;o&&(a=c.match(o))&&(l=a[1],c=a[2]),c.length>0&&(this.settings.diacritics?u=Q(c)||null:u=m(c),u&&n&&(u="\\b"+u)),i.push({string:c,regex:u?new RegExp(u,"iu"):null,field:l})}),i}getScoreFunction(t,n){var r=this.prepareSearch(t,n);return this._getScoreFunction(r)}_getScoreFunction(t){const n=t.tokens,r=n.length;if(!r)return function(){return 0};const i=t.options.fields,s=t.weights,o=i.length,c=t.getAttrFn;if(!o)return function(){return 1};const a=function(){return o===1?function(l,u){const f=i[0].field;return v(c(u,f),l,s[f]||1)}:function(l,u){var f=0;if(l.field){const h=c(u,l.field);!l.regex&&h?f+=1/o:f+=v(h,l,1)}else p(s,(h,d)=>{f+=v(c(u,d),l,h)});return f/o}}();return r===1?function(l){return a(n[0],l)}:t.options.conjunction==="and"?function(l){var u,f=0;for(let h of n){if(u=a(h,l),u<=0)return 0;f+=u}return f/r}:function(l){var u=0;return p(n,f=>{u+=a(f,l)}),u/r}}getSortFunction(t,n){var r=this.prepareSearch(t,n);return this._getSortFunction(r)}_getSortFunction(t){var n,r=[];const i=this,s=t.options,o=!t.query&&s.sort_empty?s.sort_empty:s.sort;if(typeof o=="function")return o.bind(this);const c=function(l,u){return l==="$score"?u.score:t.getAttrFn(i.items[u.id],l)};if(o)for(let l of o)(t.query||l.field!=="$score")&&r.push(l);if(t.query){n=!0;for(let l of r)if(l.field==="$score"){n=!1;break}n&&r.unshift({field:"$score",direction:"desc"})}else r=r.filter(l=>l.field!=="$score");return r.length?function(l,u){var f,h;for(let d of r)if(h=d.field,f=(d.direction==="desc"?-1:1)*X(c(h,l),c(h,u)),f)return f;return 0}:null}prepareSearch(t,n){const r={};var i=Object.assign({},n);if(y(i,"sort"),y(i,"sort_empty"),i.fields){y(i,"fields");const s=[];i.fields.forEach(o=>{typeof o=="string"&&(o={field:o,weight:1}),s.push(o),r[o.field]="weight"in o?o.weight:1}),i.fields=s}return{options:i,query:t.toLowerCase().trim(),tokens:this.tokenize(t,i.respect_word_boundaries,r),total:0,items:[],weights:r,getAttrFn:i.nesting?W:U}}search(t,n){var r=this,i,s;s=this.prepareSearch(t,n),n=s.options,t=s.query;const o=n.score||r._getScoreFunction(s);t.length?p(r.items,(a,l)=>{i=o(a),(n.filter===!1||i>0)&&s.items.push({score:i,id:l})}):p(r.items,(a,l)=>{s.items.push({score:1,id:l})});const c=r._getSortFunction(s);return c&&s.items.sort(c),s.total=s.items.length,typeof n.limit=="number"&&(s.items=s.items.slice(0,n.limit)),s}}export{tt as S,m as e};
